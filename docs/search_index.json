[["index.html", "University of Bristol OpenSAFELY Best Practice Introduction", " University of Bristol OpenSAFELY Best Practice Tom Palmer, Elsie Horne, Venexia Walker Last built on 24 May 2022 Introduction The following is intended as a set of tips for users of the OpenSAFELY system at the University of Bristol. Please use the menu to the left to read the different sections. "],["study-definition.html", "Study definition Reproducibile dummy data File formats", " Study definition Reproducibile dummy data To ensure the dummy data system generates exactly the same data every time you run it, set a random number generator seed at the top of the study_definition.py file import numpy as np np.random.seed(123456) # change this number to one for which your scripts successfully run on the dummy data File formats Use .feather files for outputs from the cohortextractor, so specify an action in your project.yaml as follows generate_study_population: run: cohortextractor:latest generate_cohort --study-definition study_definition --output-format feather needs: - design outputs: highly_sensitive: cohort: output/input.feather Use the arrow package to read .feather files into R arrow::read_feather(file = file.path(&quot;output&quot;, &quot;input.feather&quot;)) The col_select argument can be used to read in just the columns you need Start each project with a preprocessing action that formats .feather files and outputs (gzipped) .rds files which can be saved with readr::write_rds() readr::write_rds(object, file.path(&quot;output&quot;, &quot;mydata.rds&quot;), compress = &quot;gz&quot;) "],["r-code.html", "R code File formats Supported packages RStudio project", " R code File formats As per the study definition best practice, outputs from the cohortextractor should be provided as .rds files Use the readr package to read and write .rds files object &lt;- readr::read_rds(file.path(&quot;output&quot;, &quot;mydata.rds&quot;)) readr::write_rds(object, file.path(&quot;output&quot;, &quot;mydata.rds&quot;), compress = &quot;gz&quot;) All .rds files should all be classified as highly_sensitive in actions, as they cannot be opened on the results server and therefore cannot be reviewed or released. readr::write_rds does not compress files by default. It is recommended that you compress .rds files using the argument compress = \"gz\". Use file.path to construct file paths that are reproducible across operating systems. Supported packages The R packages (and their version number) which are installed in the OpenSAFELY R Docker container are listed here To request a new package, which should be on CRAN, open a new issue here, including the link to its CRAN webpage RStudio project Define your repo as an RStudio project in RStudio as follows File | New Project… Existing Directory Then find your repo This will create a .Rproj file at the top level of your repo Commit the file into your repo Now you can double click the .Rproj file to open the repo in RStudio, so you can work on your R scripts more conveniently "],["outputs-for-release.html", "Outputs for release Tables Figures Releasing output", " Outputs for release All outputs for release should be classified as moderately_sensitive in actions. OpenSAFELY does not permit information relating to between 1 and less than 5 individuals to be released. Redaction functions are available from other users to help you prepare your output. Tables Use readr::write_csv() to save .csv files that will be sent to output checkers (this is about twice as fast as utils::write.csv() and does not write row names). readr::write_csv(object, file = file.path(&quot;output&quot;, &quot;mydata.csv&quot;)) Do not save outputs to subdirectories of the output folder, otherwise running the study definition on GitHub Actions will probably fail with an error message such as Error in file(file, ifelse(append, &quot;a&quot;, &quot;w&quot;)) : cannot open the connection Calls: write.csv -&gt; eval.parent -&gt; eval -&gt; eval -&gt; write.table -&gt; file In addition: Warning message: In file(file, ifelse(append, &quot;a&quot;, &quot;w&quot;)) : cannot open file &#39;/workspace/output/descriptive/tables/table1.csv&#39;: No such file or directory Backtrace: 1: file(file, ifelse(append, &quot;a&quot;, &quot;w&quot;)) 2: write.table(table1_all$table_body, here::here(&quot;output&quot;, &quot;descriptive&quot;, 3: eval(expr, p) 4: eval(expr, p) 5: eval.parent(Call) 6: write.csv(table1_all$table_body, here::here(&quot;output&quot;, &quot;descriptive&quot;, Error: Process completed with exit code 1. Figures Use .svg for figure outputs that will be sent to output checkers Where applicable (e.g., histograms), start the x-axis at 5 instead of 0 to ensure low counts are not exported Releasing output Ensure your outputs are in the correct formats .csv (not .rds or .Rdata) for tables of data .txt or .html if you want to view them in L4 Ensure your outputs are marked as moderately_sensitive in your project.yaml To release an output, please complete the ‘Output files for review’ section of this form and email to your assigned Bristol L4 access person Bristol L4 access people will check the output on the server on your behalf, complete the rest of the form (including files locations), and email to datarelease@opensafely.org for final approval "],["miscellaneous.html", "Miscellaneous", " Miscellaneous Text files should end with a newline character (i.e., a blank line) If you see the following red icon at the end of a file on GitHub, simply press ↵ Enter at the end of the file (i.e., in this case after the Catalog), resave, commit, and the red icon should be gone Python and R versions The versions of Python and R in their respective OpenSAFELY Docker containers are (as of 1st December 2021): Python 3.8.10 R 4.0.2 The Python and R code run within their respective Docker containers. Hence the version of Python and R used to run your analyses are the versions of Python and R in these Docker containers and not the versions of Python and R on your computer To see the Python version number insert in your study_definition.py import sys print(sys.implementation.version) To see the R version number insert into one of your R analysis scripts print(R.version.string) "],["session-info-for-reproducibilty.html", "Session info for reproducibilty", " Session info for reproducibilty sessioninfo::session_info() ## ─ Session info ─────────────────────────────────────────────────────────────── ## setting value ## version R version 4.2.0 (2022-04-22) ## os macOS Monterey 12.4 ## system aarch64, darwin20 ## ui X11 ## language (EN) ## collate en_GB.UTF-8 ## ctype en_GB.UTF-8 ## tz Europe/London ## date 2022-05-24 ## pandoc 2.18 @ /opt/homebrew/bin/ (via rmarkdown) ## ## ─ Packages ─────────────────────────────────────────────────────────────────── ## package * version date (UTC) lib source ## bookdown 0.26 2022-04-15 [1] CRAN (R 4.2.0) ## bslib 0.3.1 2021-10-06 [1] CRAN (R 4.2.0) ## cli 3.3.0 2022-04-25 [1] CRAN (R 4.2.0) ## digest 0.6.29 2021-12-01 [1] CRAN (R 4.2.0) ## evaluate 0.15 2022-02-18 [1] CRAN (R 4.2.0) ## fastmap 1.1.0 2021-01-25 [1] CRAN (R 4.2.0) ## htmltools 0.5.2 2021-08-25 [1] CRAN (R 4.2.0) ## jquerylib 0.1.4 2021-04-26 [1] CRAN (R 4.2.0) ## jsonlite 1.8.0 2022-02-22 [1] CRAN (R 4.2.0) ## knitr 1.39 2022-04-26 [1] CRAN (R 4.2.0) ## magrittr 2.0.3 2022-03-30 [1] CRAN (R 4.2.0) ## R6 2.5.1 2021-08-19 [1] CRAN (R 4.2.0) ## rlang 1.0.2 2022-03-04 [1] CRAN (R 4.2.0) ## rmarkdown 2.14 2022-04-25 [1] CRAN (R 4.2.0) ## rstudioapi 0.13 2020-11-12 [1] CRAN (R 4.2.0) ## sass 0.4.1 2022-03-23 [1] CRAN (R 4.2.0) ## sessioninfo 1.2.2 2021-12-06 [1] CRAN (R 4.2.0) ## stringi 1.7.6 2021-11-29 [1] CRAN (R 4.2.0) ## stringr 1.4.0 2019-02-10 [1] CRAN (R 4.2.0) ## xfun 0.31 2022-05-10 [1] CRAN (R 4.2.0) ## yaml 2.3.5 2022-02-21 [1] CRAN (R 4.2.0) ## ## [1] /Library/Frameworks/R.framework/Versions/4.2-arm64/Resources/library ## ## ────────────────────────────────────────────────────────────────────────────── "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
